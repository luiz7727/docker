O que é o Docker ?
R: É uma tecnologia de virtualização, e não um sistema de virtualização tradicional(baseado em máquinas virtuais).O docker é uma engine de administração de containers, ou seja, ela é um serviço que vai administrar os containers que vc cria a partir do docker.

Container = é um processo isolado do seu sistema que a partir daquele processo, vc pode startar as suas aplicações de forma isolada do sistema host(fora daquela máquina que o container foi criado) e associado a esse container existe tbm um sistema de arquivos completos isolados para que vc possa executar o seu software dentro de um ambiente o mais controlável possível.

Por que o Docker não é uma máquina virtual ?
Porque esse processo segregado(container) junto desse sistema de arquivo isolados, ele precisa de várias coisas da máquina host, ele não vai executar o container de forma totalmente independente da máquina host, porque vários recursos serão compartilhados(como por exemplo o Kernel).E isso faz com que o container tenha uma nessecidade de memória e de processamento muito menor do que uma máquina virtual precisa.

O Docker se baseia em uma tecnologia chamada LXC(linux Containers)

Docker é Open Source e Escrita em Go

O tipo de virtualização que o docker usa é baseado em software(SO)
SO = Sistema Operacional.

Host e container compartilham o Kernel.


Empacota software com vários níveis de isolamento

Por que não usar uma máquina virtual ?

*isolamento do sistema
*elasticidade (aumentar e diminuir a quantidade de recursos)
Capacidade de dimencionar quanto de memória precisa, por exemplo.

O container tem uma vantagem muito grande sobre as máquinas virtuais, é a quantidade de recursos que ele consome ao ser executado.

Exemplos:
 
1-É possível startar um container em menos de um segundo, sendo uma máquina virtual levaria em torno de 1 minuto.

2-A quantidade de memória que um container usa, é absurdamente menor do que uma máquina virtual.

O que são container ?

-Processo segregado no mesmo Kernel(isolamento) da máquina host
-Sistema de arquivos criados a partir de uma imagem
-Ambientes leves e portáteis no qual aplicações são executadas
-Encapsula todos os binários e bibliotecas necessárias para execução de um App
-Algo entre um 	chroot uma VM

Obs:chroot, comando que redefine a pasta raiz para um determinado processo que vc deseja executar.

Obs:Focar um container no uso de uma aplicação só.Por exemplo:Um container para o banco de dados, outro para o backend e outro para o frontend

O que são imagens Docker ?
1-Uma imagem é o modelo de sistema de arquivo somente-leitura usado para criar container.
2-Imagens são criadas através de um processor chamado build ou pelo commit, mas o commit não é uma boa prática.
3-São armazenadas em repositório Registry(no caso é o docker hub)
4-São compostas por uma ou mais camadas(famosas layers)
5-Uma camada representa um ou mais mudanças no sistema de arquivo
6-Uma camada é tabmém chmada de imagem intermediária
7-A junção dessas camadas formm a imagem
8-A apenas a útlima camada pode ser alterar quadno o contianer for iniciado
9-AUFS(Advanced multi-layered unification filesystem) é muito usado.Um sistema de arquivo baseado em layer.
10-O grande objetivo dessa estratégia de dividir uma iamgem em cadams é o reuso 
11 -É possível compor imagens a partir de camadas de outras imagens.

Porque o commit é ruim ?
R:Imagine que vc tem acesso a esse container a partir do terminal, no final tudo que vc alterou vc quer criar uma imagem, a partir desse container.Usando o comando commit, ele vai pegar tudo que vc alterou no seu container e salva como imagem.
O problema é que vc não tem como replicar o que vc fez, vc não tem um rastro do que vc fez.

Container vs Image

Container está relacionado com o processo, e o processo quando executado está na memória do computador.

(fazendo uma relação com Orientação a Objetos)
Temos a imagem(modelo,classe) usada como classe para criar os containers, que seria os objetos.


Arquitetura

DAEMON = docker server = docker engine.O cli(terminal) é conectado com o DAEMON que é a partir dele que vc cria as imagens, que vai lá no registry do docker(site do docker hub, e nele contem um monte de imagens já pronta).

CLI(terminal) -> DAEMON -> docker hub(baixar a imagem) -> devolve ela -> criar os containers

Hello World no docker

* Comando para dar hello world: docker container run hello-world

Pode dar um possível erro de permisão de usuário, com isso rode esse comando no terminal:
sudo usermod -aG nomeuser
reinicie a máquina e depois rode o comando caso não funcione, rode esse comando:
docker run hello-world


Comando Run
O comando run é a porta de entrada para o mundo docker, por que ele agrupa uma série de comandos a partir do comando run.
A partir do comando run a gente baixou uma imagem, caso ela não exista.Ciração de um container, execução de um container.
O comando run é a concatenação de 4 comandos, se pensarmos bem.Pois ele baixa a imagem caso não tenha, cria o container,starta o container e executa ele

1 - docker pull nomeImage(baixa imagem do Repository, é o docker hub)
2 - docker container create (criar o container)
3 - docker container start (startar o container)
4 - docker container exec (execução do container em modo interativo)

Modo interativo é voce poder ver todo o processo no terminal da execução.

Comandos Docker

docker container ps ou docker ps = para ver quais containers estão rodando
docker container ps -a ou docker container ps -a = mostra todos os containers que tem instalado, independente se está rodando ou não

docker run --rm nomeImage COMMAND ou docker container run --rm nomeImage COMMAND = executa o container e quando terminar o processo, eu quero que ele automaticamente remova da lista de containers

-it  i = modo interativo t = acesso ao terminal

O comando run sempre criar novos container

docker container run -it nameImage ou docker run -it nameImage  = entra no terminal do container.
Se vc executar o comando acima duas vezes, vc está criando dois containers.Ou seja, se vc criar uma pasta em um container.Não vai aparecer no outro.

Containers devem ter nomes únicos 

Comando para atribuir um nome para o container:
docker run --name nameContainer -it image command ou docker container run --name nameContainer -it image command  
Não consegue criar containers com o mesmo nome.


Reutilizar containers
docker start -ai ou docker container start -ai (a = apache, vou ter acesso ao terminal) ( o i é do modo interativo)
* Colocar nomes significantes, com isso vc pode fazer as operações com tranquilidade


Mapeando portas dos containers
-p = port
porta 8080 porta que vai ser exposta para fora do container
porta 80 é a porta interna que nginx vai startado
docker run -p 8080:80 nameImage

Depois é só rodar esse comando no terminal para ver o resultado:
curl http://localhost:8080 ou vc pode acessar o localhost:8080 no navegador mesmo


Mapeando diretórios para o container

mapear um pasta do computador host para o container
flag -v para mapear um volume 

docker run -p 8080:80 -v pastaHost:pastaDentroDoContainer ou docker container run -p 8080:80 -v pastaHost:pastaDentroDoContainer

pwd = caminho da pasta atual
docker run -p 8080:80 -v $(pwd):pastaDentroDoContainer


Executando o container em background
-d(daemon)
docker run -d --name ex-daemon-basic -p 8080:80 $(pwd):/usr/share/nginx/html
 ou
docker container run -d --name ex-daemon-basic -p 8080:80 $(pwd):/usr/share/nginx/html
com isso ele retorna uma string com uma série de caracteres(id do container gerado).Com isso o container está sendo executado em modo de background.

Para verificar
docker ps

Para parar o container
docker stop nameContainer


Gerenciando container em background

comando para executar o container:
docker start nameContainer ou docker container start nameContainer 

comando para restartar o container:
docker restart nameContainer ou docker container restart nameContainer


Manipulação de containers em modo daemon

Acessando logs de um container:

docker container logs nameContainer

Ele retorna os logs que foram executados

Acessando o inspect de um container
docker container inspect ex-daemon-basic

Ele retorna no formato json toda as características do container

docker container exec nameContainer uname -or
Retorna o tipo de sistema que está sendo executado dentro do container.

docker rmi idVolume serve para remover imagem
docker rm para remover containers

comando para remover imagens:
docker image rm nameImage


Comandos básicos no gerenciamento de imagens
docker image pull(responsável por baixar a imagem no docker hub)
docker image ls( mostra as imagens)
docker image rm nameTag
docker image inspect
docker image tag nameImageOrigin nomeDaTagQueQUerColocar (passsa dois parametro)
docker image build
docker image push (serve para mandar a imagem para algum lugar, como por exemplo docker hub)

Docker Hub vs Docker Registry

Docker Registry é um serviço server side para registro e obtenção de imagem.Api basicamente.
Docker Hub é um SAS, é um produto na nuvem disponibilizado pelo docker.O docker hub contem o registry dentro dele, mas ele tem uma interface gráfica


Primeiro Build com docker
1 - Criar um docker file  
2 - FROM nginx:lastest Se vc quer que a sua imagem seje baseada de qual imagem
3 - RUN echo '<h1>Hello World from Firt deploy!</h1>' > /usr/share/nginx/html/index.html vou mandar a saída desse "echo" para a pasta onde o nginx vai ler.Com isso se a imagem que vc estiver se baseando, tiver 3 layers, com o novo comando seu, a sua imagem vai ter 4 layers.
4 - Entrar no terminal na pasta que foi criado o arquivo Dockerfile
5 - docker image build -t nameTag .(-t = tag que vc quer colocar)
6 - docker container run -p 80:80 nameTag


Criando imagem com parametros
FROM debian
LABEL maintainer(maintainer = quem é o mantenedor da imagem) 

Visão Geral e Tipos de Redes
O docker usa o modelo Bridge

Bridge serve tbm como mecanismo de isolamento da rede

1-Container A(com a interface de rede por baixo)
2-Bridge
3-Host
4-Internet

Tipos de Redes
* None Network(container não tem acesso a rede e tbm não acessa outros containers locais)
  docker container run -d --net none nameImage
* Bridge Network(Padrão) Ponte que o docker cria entre as interfaces de rede dos containers e a interface de rede do host
* Host Network(tirar a camada bridge e ter acesso diretamente com a interface de rede do host, menos adequado)
* Overlay Network(Swarm)

Pingando um container com o otro
1 - Criar dois containers e abrir o inspect
2 - docker container exec -it container1 ping 172.17.0.3(esse é o ping do segundo container) 

comandos para criar uma nova rede 
docker network create --driver bridge  rede_nova
--driver seria os tipos de redes que docker contain
Com isso ele cria outra faixa "172.18.0.0/16", pois o padrão é 172.17.0.0/16

criando o container com a nova rede
docker container run -d --name container3 --net rede_nova

Se vc tentar pingas esse novo container com a nova rede com um outro container que contem a faixa diferente, vc não vai conseguir logo de cara.

Para resolver isso, precisamos configurar o container para se conectar com a rede bridge

docker network connect bridge nameContainer
Com isso o container vai ter acesso tanto com a rede nova, tanto com a rede normal que vem por padrão.

Caso queira desconectar o container da rede bridge:
docker network disconnect bridge nameContainer



Testar a conectividade de uma máquina com a outra, elas sendo conectadas na mesma rede:
docker container exec -it container1 ping 172.17.0.3(esse é o ping do segundo container)


Coordenando Mútiplos Containers
 -Muito usado para aplicações e o frontend está em um container e o backend está em outro container.
 Para isso muito usado o docker compose, que ele starta os containers para vc.Ao invés de vc ficar startando um por um

Gerenciamento de micro service
micro service = serviços diferentes, ciclos diferentes, deploys diferentes e esses serviços juntos formam uma aplicação
docker-compose.yml formato de arquivo usado pelo compose
